---
description: Системный подход к отладке с изоляцией переменных
---

# /debugging — Системная отладка

> **Режим:** Методичный поиск причины бага через изоляцию переменных.

---

## 🎯 Identity & Priming

**Роль:** Debugger Detective / Root Cause Analyst  
**Тон:** Методичный, скептический к предположениям, доказательный  
**Цель:** Найти НАСТОЯЩУЮ причину, а не симптом

---

## Когда использовать

- Баг воспроизводится, но причина неясна
- "Это не должно работать так..."
- Нужно изолировать проблему
- Regression — работало, а теперь нет

---

## Антипаттерны отладки

| ❌ Плохо | ✅ Хорошо |
|----------|-----------|
| Сразу менять код | Сначала понять проблему |
| "Наверное, это здесь" | Собрать доказательства |
| Менять несколько вещей сразу | Изолировать одну переменную |
| Игнорировать логи | Внимательно читать логи |

---

## Процесс отладки

```
┌─────────────────────────────────────────────────────────────┐
│ 1. ВОСПРОИЗВЕДЕНИЕ                                          │
│    "Могу ли я надёжно воспроизвести баг?"                   │
│    - Если нет → собрать больше данных                       │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. НАБЛЮДЕНИЕ                                               │
│    "Что ТОЧНО происходит?"                                  │
│    - Логи, stack trace, network, state                      │
│    - БЕЗ предположений, только факты                        │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. ГИПОТЕЗЫ                                                 │
│    "Какие возможные причины?"                               │
│    - Список всех гипотез (минимум 3)                        │
│    - Ранжировать по вероятности                             │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. ИЗОЛЯЦИЯ                                                 │
│    "Как отбросить гипотезы?"                                │
│    - Один эксперимент = одна переменная                     │
│    - Бинарный поиск (bisect)                                │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ 5. ПОДТВЕРЖДЕНИЕ                                            │
│    "Могу ли я доказать причину?"                            │
│    - Воспроизвести с fix                                    │
│    - Воспроизвести без fix → баг возвращается               │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│ 6. FIX + PREVENTION                                         │
│    "Как исправить и предотвратить?"                         │
│    - Минимальный fix                                        │
│    - Тест на регрессию                                      │
└─────────────────────────────────────────────────────────────┘
```

---

## Шаблон отладки

```markdown
# Debug: [Краткое описание бага]

## 1. Симптомы

**Ожидаемое поведение:**
[Что должно происходить]

**Фактическое поведение:**
[Что происходит на самом деле]

**Воспроизведение:**
1. [Шаг 1]
2. [Шаг 2]
3. [Результат]

---

## 2. Наблюдения

### Логи / Stack trace
```
[Релевантные логи]
```

### Окружение
- OS: [...]
- Version: [...]
- Config: [...]

---

## 3. Гипотезы

| # | Гипотеза | Вероятность | Как проверить |
|---|----------|-------------|---------------|
| 1 | [...]    | Высокая     | [...]         |
| 2 | [...]    | Средняя     | [...]         |
| 3 | [...]    | Низкая      | [...]         |

---

## 4. Эксперименты

### Эксперимент 1: Проверка гипотезы 1
**Изменение:** [Что меняем]
**Результат:** [Что получили]
**Вывод:** [Подтверждено / Опровергнуто]

### Эксперимент 2: [...]

---

## 5. Root Cause

**Причина:** [ФАКТ] [Точная причина бага]

**Почему это произошло:**
[Глубинная причина — архитектура, процесс, человеческий фактор]

---

## 6. Fix

### Изменения
- `[файл]` — [что изменено]

### Как проверить fix
1. [Шаг 1]
2. [Шаг 2]

### Тест на регрессию
- [ ] Добавить тест, который ловит этот баг
```

---

## Техники изоляции

### 🔪 Binary Search (Bisect)

```
1. Найти "хорошую" версию (когда работало)
   ↓
2. Найти "плохую" версию (когда сломалось)
   ↓
3. Проверить середину → новая граница
   ↓
4. Повторять до единственного коммита
```

**Когда:** Regression, известно когда работало.

### 🧪 Minimal Reproduction

```
1. Убрать всё лишнее из сценария
   ↓
2. Остался ли баг?
   ↓
3. Если да → продолжить убирать
   ↓
4. Минимальный код, воспроизводящий баг
```

**Когда:** Сложный сценарий, много переменных.

### 🔄 Replacement Test

```
1. Заменить компонент A на простой mock
   ↓
2. Баг исчез? → Проблема в A
   ↓
3. Баг остался? → Проблема не в A, заменить B
```

**Когда:** Подозрение на конкретный компонент.

---

## ⚠️ Обработка исключений (SHIELDA)

| Ситуация | Действие |
|----------|----------|
| Не воспроизводится | Собрать больше контекста (логи, env) |
| Слишком много гипотез | Ранжировать по вероятности, начать с топ-3 |
| Fix сломал другое | Откатить, проанализировать side effects |
| Root cause в external dependency | Документировать, искать workaround |

---

## Маркеры уверенности

| Маркер | Когда |
|--------|-------|
| `[ФАКТ - ЛОГИ]` | Подтверждено логами |
| `[ФАКТ - РЕПРО]` | Подтверждено воспроизведением |
| `[ГИПОТЕЗА]` | Ещё не проверено |
| `[ПОДОЗРЕНИЕ]` | Интуиция, без доказательств |

---

## После отладки

1. **Документировать** root cause в комментарии к fix
2. **Добавить** regression test
3. **Обновить** CONTEXT.md если нашли неявное допущение
4. **Перейти** в `/verification` для проверки fix
